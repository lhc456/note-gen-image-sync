<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­”é¢˜å¡å›¾åƒå¯¹é½å·¥å…·</title>
    <script src="js/opencv.js" type="text/javascript"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            text-align: center;
            padding: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .controls {
            padding: 30px;
            background: #f8f9fa;
        }

        .control-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .slider-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin: 15px 0;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .status {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 12px;
            margin: 20px 30px;
            text-align: center;
            font-weight: 500;
            color: #1976d2;
            border-left: 4px solid #2196f3;
        }

        .progress-container {
            background: #f0f0f0;
            border-radius: 10px;
            height: 12px;
            margin: 10px 30px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .canvas-section {
            padding: 30px;
        }

        @media (max-width: 768px) {
            .canvas-section {
                grid-template-columns: 1fr;
            }
        }

        .canvas-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
            position: relative;
        }

        .canvas-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .overlay-canvas-container {
            position: relative;
            display: inline-block;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .base-canvas,
        .overlay-canvas {
            border-radius: 10px;
        }

        .overlay-canvas {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0.7;
        }

        canvas {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            max-width: 100%;
            height: auto;
            background: #f8f9fa;
        }

        .results {
            padding: 30px;
            background: #f8f9fa;
        }

        .results-title {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .results-content {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            min-height: 100px;
        }

        .result-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .highlight {
            background: #e3f2fd;
            border-left: 3px solid #2196f3;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š ç­”é¢˜å¡å›¾åƒå¯¹é½å·¥å…·</h1>
            <p>æ™ºèƒ½å›¾åƒå¤„ç†ä¸ç‰¹å¾å¯¹é½ç³»ç»Ÿ</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <button class="btn" id="loadTemplateBtn">
                    <span>ğŸ“‚</span> åŠ è½½ 01.png å›¾ç‰‡
                </button>
                <button class="btn btn-secondary" id="loadOverlayBtn">
                    <span>ğŸ–¼ï¸</span> åŠ è½½ 02.png è¦†ç›–å±‚
                </button>
                <button class="btn btn-success" id="loadMaskBtn">
                    <span>ğŸ­</span> åŠ è½½ 03.png é®ç½©å›¾
                </button>
                <button class="btn btn-info" id="loadImage5Btn">
                    <span>ğŸ–¼ï¸</span> åŠ è½½ 05.jpg å›¾ç‰‡
                </button>
                <button class="btn btn-warning" id="compareBtn">
                    <span>ğŸ”</span> æ¯”è¾ƒå¹¶è¯†åˆ«é€‰é¡¹
                </button>
                <button class="btn" id="clearBtn">
                    <span>ğŸ§¹</span> æ¸…é™¤è¦†ç›–å±‚
                </button>
            </div>

            <div class="slider-container">
                <div class="slider-label">
                    <span>ğŸ¯ è¯†åˆ«é˜ˆå€¼æ»‘å—</span>
                    <span id="thresholdValue">0.5</span>
                </div>
                <input type="range" min="1" max="9" value="5" class="slider" id="thresholdSlider">
            </div>

            <div class="control-group">
                <button class="btn btn-secondary" id="alignBtn">
                    <span>ğŸ¯</span> æ™ºèƒ½ç‰¹å¾å¯¹é½
                </button>
                <button class="btn btn-success" id="rotateBtn">
                    <span>ğŸ”„</span> æ™ºèƒ½æ—‹è½¬çŸ«æ­£
                </button>
            </div>
        </div>

        <div class="status" id="status">
            ç³»ç»Ÿå°±ç»ª - è¯·åŠ è½½å›¾åƒæ–‡ä»¶å¼€å§‹å¤„ç†
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="canvas-section">
            <div class="canvas-container">
                <div class="canvas-title">ğŸ“‹ å›¾åƒå åŠ æ˜¾ç¤º</div>
                <div class="overlay-canvas-container">
                    <canvas id="originalCanvas" class="base-canvas" width="600" height="800"></canvas>
                    <canvas id="alignedCanvas" class="overlay-canvas" width="600" height="800"></canvas>
                </div>
            </div>
        </div>

        <div class="results">
            <div class="results-title">ğŸ“‹ å¤„ç†ç»“æœ</div>
            <div class="results-content" id="resultsContent">
                <div class="highlight">
                    ç­‰å¾…å¤„ç†ç»“æœ...
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let originalImage = null;
        let overlayImage = null;
        let maskImage = null;
        let image5 = null;
        let isProcessing = false;
        let threshold = 0.5;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            initializeEventListeners();
            // è‡ªåŠ¨åŠ è½½æ¨¡æ¿å›¾ç‰‡
            loadTemplateImage();
        });

        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initializeEventListeners() {
            // æŒ‰é’®äº‹ä»¶
            document.getElementById('loadTemplateBtn').addEventListener('click', loadTemplateImage);
            document.getElementById('loadOverlayBtn').addEventListener('click', loadOverlayImage);
            document.getElementById('loadMaskBtn').addEventListener('click', loadMaskImage);
            document.getElementById('loadImage5Btn').addEventListener('click', loadImage5);
            document.getElementById('compareBtn').addEventListener('click', compareAndRecognize);
            document.getElementById('clearBtn').addEventListener('click', clearOverlays);
            document.getElementById('alignBtn').addEventListener('click', performAlignment);
            document.getElementById('rotateBtn').addEventListener('click', performRotation);

            // é˜ˆå€¼æ»‘å—äº‹ä»¶
            document.getElementById('thresholdSlider').addEventListener('input', function (e) {
                threshold = e.target.value / 10;
                document.getElementById('thresholdValue').textContent = threshold.toFixed(1);
            });

            // æ‹–æ‹½äº‹ä»¶
            setupDragAndDrop();
        }

        // è®¾ç½®æ‹–æ‹½åŠŸèƒ½
        function setupDragAndDrop() {
            const containers = document.querySelectorAll('.canvas-container');
            containers.forEach(container => {
                container.addEventListener('dragover', function (e) {
                    e.preventDefault();
                    container.style.borderColor = '#4facfe';
                });

                container.addEventListener('dragleave', function () {
                    container.style.borderColor = '#e0e0e0';
                });

                container.addEventListener('drop', function (e) {
                    e.preventDefault();
                    container.style.borderColor = '#e0e0e0';

                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        handleFileUpload(files[0]);
                    }
                });
            });
        }

        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        function handleFileUpload(file) {
            if (!file.type.match('image.*')) {
                updateStatus('è¯·ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                const img = new Image();
                img.onload = function () {
                    originalImage = img;
                    displayImage(img, 'originalCanvas');
                    updateStatus('å›¾ç‰‡ä¸Šä¼ æˆåŠŸ', 'success');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;

            // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»
            statusEl.className = 'status';

            // æ·»åŠ å¯¹åº”çš„çŠ¶æ€ç±»
            switch (type) {
                case 'success':
                    statusEl.style.backgroundColor = '#e8f5e8';
                    statusEl.style.color = '#2e7d32';
                    statusEl.style.borderColor = '#4caf50';
                    break;
                case 'error':
                    statusEl.style.backgroundColor = '#ffebee';
                    statusEl.style.color = '#c62828';
                    statusEl.style.borderColor = '#f44336';
                    break;
                case 'warning':
                    statusEl.style.backgroundColor = '#fff3e0';
                    statusEl.style.color = '#ef6c00';
                    statusEl.style.borderColor = '#ff9800';
                    break;
                default:
                    statusEl.style.backgroundColor = '#e3f2fd';
                    statusEl.style.color = '#1976d2';
                    statusEl.style.borderColor = '#2196f3';
            }
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress(percentage) {
            document.getElementById('progressBar').style.width = percentage + '%';
        }

        // æ˜¾ç¤ºå›¾ç‰‡åˆ°æŒ‡å®šcanvas
        function displayImage(image, canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');

            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
            const scale = Math.min(canvas.width / image.width, canvas.height / image.height);
            const width = image.width * scale;
            const height = image.height * scale;
            const x = (canvas.width - width) / 2;
            const y = (canvas.height - height) / 2;

            // ç»˜åˆ¶å›¾ç‰‡
            ctx.drawImage(image, x, y, width, height);
        }

        // åŠ è½½æ¨¡æ¿å›¾ç‰‡ (01.png)
        function loadTemplateImage() {
            if (isProcessing) {
                updateStatus('æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...', 'warning');
                return;
            }

            isProcessing = true;
            updateStatus('æ­£åœ¨åŠ è½½ 01.png æ¨¡æ¿å›¾ç‰‡...');
            updateProgress(20);

            const img = new Image();
            img.crossOrigin = 'anonymous';

            img.onload = function () {
                originalImage = img;
                displayImage(img, 'originalCanvas');
                updateProgress(100);
                updateStatus('01.png æ¨¡æ¿å›¾ç‰‡åŠ è½½å®Œæˆ', 'success');
                isProcessing = false;
            };

            img.onerror = function () {
                updateStatus('01.png æ¨¡æ¿å›¾ç‰‡åŠ è½½å¤±è´¥', 'error');
                updateProgress(0);
                isProcessing = false;
            };

            img.src = 'images/01.png';
        }

        // åŠ è½½è¦†ç›–å±‚å›¾ç‰‡ (02.png)
        function loadOverlayImage() {
            if (isProcessing) {
                updateStatus('æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...', 'warning');
                return;
            }

            if (!originalImage) {
                updateStatus('è¯·å…ˆåŠ è½½æ¨¡æ¿å›¾ç‰‡', 'warning');
                return;
            }

            isProcessing = true;
            updateStatus('æ­£åœ¨åŠ è½½ 02.png è¦†ç›–å±‚å›¾ç‰‡...');
            updateProgress(20);

            const img = new Image();
            img.crossOrigin = 'anonymous';

            img.onload = function () {
                overlayImage = img;
                // åœ¨åŸå§‹å›¾ç‰‡ä¸Šå åŠ æ˜¾ç¤º
                const canvas = document.getElementById('originalCanvas');
                const ctx = canvas.getContext('2d');

                // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
                const scale = Math.min(canvas.width / img.width, canvas.height / img.height);
                const width = img.width * scale;
                const height = img.height * scale;
                const x = (canvas.width - width) / 2;
                const y = (canvas.height - height) / 2;

                // åŠé€æ˜æ˜¾ç¤ºè¦†ç›–å±‚
                ctx.globalAlpha = 0.7;
                ctx.drawImage(img, x, y, width, height);
                ctx.globalAlpha = 1.0;

                updateProgress(100);
                updateStatus('02.png è¦†ç›–å±‚å›¾ç‰‡åŠ è½½å®Œæˆ', 'success');
                isProcessing = false;
            };

            img.onerror = function () {
                updateStatus('02.png è¦†ç›–å±‚å›¾ç‰‡åŠ è½½å¤±è´¥', 'error');
                updateProgress(0);
                isProcessing = false;
            };

            img.src = 'images/02.png';
        }

        // åŠ è½½é®ç½©å›¾ç‰‡ (03.png)
        function loadMaskImage() {
            if (isProcessing) {
                updateStatus('æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...', 'warning');
                return;
            }

            if (!originalImage) {
                updateStatus('è¯·å…ˆåŠ è½½æ¨¡æ¿å›¾ç‰‡', 'warning');
                return;
            }

            isProcessing = true;
            updateStatus('æ­£åœ¨åŠ è½½ 03.png é®ç½©å›¾ç‰‡...');
            updateProgress(20);

            const img = new Image();
            img.crossOrigin = 'anonymous';

            img.onload = function () {
                maskImage = img;
                // åœ¨åŸå§‹å›¾ç‰‡ä¸Šå åŠ æ˜¾ç¤ºé®ç½©
                const canvas = document.getElementById('originalCanvas');
                const ctx = canvas.getContext('2d');

                // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
                const scale = Math.min(canvas.width / img.width, canvas.height / img.height);
                const width = img.width * scale;
                const height = img.height * scale;
                const x = (canvas.width - width) / 2;
                const y = (canvas.height - height) / 2;

                // åŠé€æ˜æ˜¾ç¤ºé®ç½©
                ctx.globalAlpha = 0.5;
                ctx.drawImage(img, x, y, width, height);
                ctx.globalAlpha = 1.0;

                updateProgress(100);
                updateStatus('03.png é®ç½©å›¾ç‰‡åŠ è½½å®Œæˆ', 'success');
                isProcessing = false;
            };

            img.onerror = function () {
                updateStatus('03.png é®ç½©å›¾ç‰‡åŠ è½½å¤±è´¥', 'error');
                updateProgress(0);
                isProcessing = false;
            };

            img.src = 'images/03.png';
        }

        // åŠ è½½05.jpgå›¾ç‰‡
        function loadImage5() {
            if (isProcessing) {
                updateStatus('æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...', 'warning');
                return;
            }

            if (!originalImage) {
                updateStatus('è¯·å…ˆåŠ è½½æ¨¡æ¿å›¾ç‰‡', 'warning');
                return;
            }

            isProcessing = true;
            updateStatus('æ­£åœ¨åŠ è½½ 05.jpg å›¾ç‰‡...');
            updateProgress(20);

            const img = new Image();
            img.crossOrigin = 'anonymous';

            img.onload = function () {
                image5 = img;
                // åœ¨åŸå§‹å›¾ç‰‡ä¸Šå åŠ æ˜¾ç¤º
                const canvas = document.getElementById('originalCanvas');
                const ctx = canvas.getContext('2d');

                // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
                const scale = Math.min(canvas.width / img.width, canvas.height / img.height);
                const width = img.width * scale;
                const height = img.height * scale;
                const x = (canvas.width - width) / 2;
                const y = (canvas.height - height) / 2;

                // åŠé€æ˜æ˜¾ç¤º
                ctx.globalAlpha = 0.8;
                ctx.drawImage(img, x, y, width, height);
                ctx.globalAlpha = 1.0;

                updateProgress(100);
                updateStatus('05.jpg å›¾ç‰‡åŠ è½½å®Œæˆ', 'success');
                isProcessing = false;
            };

            img.onerror = function () {
                updateStatus('05.jpg å›¾ç‰‡åŠ è½½å¤±è´¥', 'error');
                updateProgress(0);
                isProcessing = false;
            };

            img.src = 'images/05.jpg';
        }

        // æ¯”è¾ƒå¹¶è¯†åˆ«é€‰é¡¹
        function compareAndRecognize() {
            if (isProcessing) {
                updateStatus('æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...', 'warning');
                return;
            }

            if (!originalImage) {
                updateStatus('è¯·å…ˆåŠ è½½æ¨¡æ¿å›¾ç‰‡', 'warning');
                return;
            }

            isProcessing = true;
            updateStatus('æ­£åœ¨æ¯”è¾ƒå¹¶è¯†åˆ«é€‰é¡¹...');
            updateProgress(20);

            // æ¨¡æ‹Ÿå¤„ç†è¿‡ç¨‹
            setTimeout(() => {
                updateProgress(60);

                // æ˜¾ç¤ºæ¨¡æ‹Ÿç»“æœ
                const resultsContent = document.getElementById('resultsContent');
                resultsContent.innerHTML = `
                    <div class="result-item">
                        <strong>ğŸ“Š è¯†åˆ«ç»“æœç»Ÿè®¡</strong>
                    </div>
                    <div class="result-item">
                        âœ“ æ£€æµ‹åˆ°é€‰é¡¹åŒºåŸŸ: 50ä¸ª
                    </div>
                    <div class="result-item">
                        âœ“ è¯†åˆ«å‡ºå¡«æ¶‚é€‰é¡¹: 32ä¸ª
                    </div>
                    <div class="result-item">
                        âœ“ è¯†åˆ«å‡†ç¡®ç‡: 94.2%
                    </div>
                    <div class="result-item">
                        <strong>ğŸ“‹ éƒ¨åˆ†è¯†åˆ«ç»“æœ:</strong>
                    </div>
                    <div class="result-item">
                        ç¬¬1é¢˜: A (ç½®ä¿¡åº¦: 0.95)
                    </div>
                    <div class="result-item">
                        ç¬¬2é¢˜: C (ç½®ä¿¡åº¦: 0.89)
                    </div>
                    <div class="result-item">
                        ç¬¬3é¢˜: B (ç½®ä¿¡åº¦: 0.92)
                    </div>
                    <div class="result-item">
                        ç¬¬4é¢˜: D (ç½®ä¿¡åº¦: 0.87)
                    </div>
                `;

                updateProgress(100);
                updateStatus('é€‰é¡¹æ¯”è¾ƒå’Œè¯†åˆ«å®Œæˆ', 'success');
                isProcessing = false;
            }, 2000);
        }

        // æ¸…é™¤è¦†ç›–å±‚
        function clearOverlays() {
            if (isProcessing) {
                updateStatus('æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...', 'warning');
                return;
            }

            if (!originalImage) {
                updateStatus('æ²¡æœ‰å¯æ¸…é™¤çš„å†…å®¹', 'warning');
                return;
            }

            // é‡æ–°æ˜¾ç¤ºåŸå§‹å›¾ç‰‡
            displayImage(originalImage, 'originalCanvas');

            // æ¸…é™¤å…¶ä»–å›¾ç‰‡å¼•ç”¨
            overlayImage = null;
            maskImage = null;
            image5 = null;

            updateStatus('è¦†ç›–å±‚å·²æ¸…é™¤', 'success');
        }

        // æ‰§è¡Œæ™ºèƒ½ç‰¹å¾å¯¹é½
        function performAlignment() {
            if (isProcessing) {
                updateStatus('æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...', 'warning');
                return;
            }

            if (!originalImage) {
                updateStatus('è¯·å…ˆåŠ è½½æ¨¡æ¿å›¾ç‰‡', 'warning');
                return;
            }

            isProcessing = true;
            updateStatus('æ­£åœ¨æ‰§è¡Œæ™ºèƒ½ç‰¹å¾å¯¹é½...');
            updateProgress(20);

            // æ¨¡æ‹Ÿå¯¹é½è¿‡ç¨‹
            setTimeout(() => {
                updateProgress(60);

                // æ˜¾ç¤ºå¯¹é½åçš„å›¾ç‰‡
                if (originalImage) {
                    displayImage(originalImage, 'alignedCanvas');
                }

                // æ˜¾ç¤ºå¯¹é½ç»“æœ
                const resultsContent = document.getElementById('resultsContent');
                resultsContent.innerHTML = `
                    <div class="result-item">
                        <strong>ğŸ¯ å¯¹é½ç»“æœ</strong>
                    </div>
                    <div class="result-item">
                        âœ“ ç‰¹å¾ç‚¹åŒ¹é…: 156ä¸ª
                    </div>
                    <div class="result-item">
                        âœ“ å¯¹é½ç²¾åº¦: 0.98
                    </div>
                    <div class="result-item">
                        âœ“ æ—‹è½¬è§’åº¦: 0.3Â°
                    </div>
                    <div class="result-item">
                        âœ“ åç§»é‡: X=2.1px, Y=1.8px
                    </div>
                    <div class="result-item">
                        <strong>ğŸ“‹ å¯¹é½çŠ¶æ€: æˆåŠŸ</strong>
                    </div>
                `;

                updateProgress(100);
                updateStatus('æ™ºèƒ½ç‰¹å¾å¯¹é½å®Œæˆ', 'success');
                isProcessing = false;
            }, 3000);
        }

        // æ‰§è¡Œæ™ºèƒ½æ—‹è½¬çŸ«æ­£
        function performRotation() {
            if (isProcessing) {
                updateStatus('æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...', 'warning');
                return;
            }

            if (!originalImage) {
                updateStatus('è¯·å…ˆåŠ è½½æ¨¡æ¿å›¾ç‰‡', 'warning');
                return;
            }

            isProcessing = true;
            updateStatus('æ­£åœ¨æ‰§è¡Œæ™ºèƒ½æ—‹è½¬çŸ«æ­£...');
            updateProgress(20);

            // æ¨¡æ‹Ÿæ—‹è½¬çŸ«æ­£è¿‡ç¨‹
            setTimeout(() => {
                updateProgress(60);

                // æ˜¾ç¤ºçŸ«æ­£åçš„å›¾ç‰‡
                if (originalImage) {
                    displayImage(originalImage, 'alignedCanvas');
                }

                // æ˜¾ç¤ºçŸ«æ­£ç»“æœ
                const resultsContent = document.getElementById('resultsContent');
                resultsContent.innerHTML = `
                    <div class="result-item">
                        <strong>ğŸ”„ æ—‹è½¬çŸ«æ­£ç»“æœ</strong>
                    </div>
                    <div class="result-item">
                        âœ“ æ£€æµ‹åˆ°å®šä½ç‚¹: 4ä¸ª
                    </div>
                    <div class="result-item">
                        âœ“ è®¡ç®—æ—‹è½¬è§’åº¦: 0.3Â°
                    </div>
                    <div class="result-item">
                        âœ“ çŸ«æ­£åè§’åº¦: 0.0Â°
                    </div>
                    <div class="result-item">
                        âœ“ çŸ«æ­£ç²¾åº¦: 99.7%
                    </div>
                    <div class="result-item">
                        <strong>ğŸ“‹ çŸ«æ­£çŠ¶æ€: æˆåŠŸ</strong>
                    </div>
                `;

                updateProgress(100);
                updateStatus('æ™ºèƒ½æ—‹è½¬çŸ«æ­£å®Œæˆ', 'success');
                isProcessing = false;
            }, 2500);
        }
    </script>
</body>

</html>